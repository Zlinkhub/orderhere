<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel - Azayaka Laundry</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      background: #f7f8fc;
    }
    header {
      background: linear-gradient(135deg, #4f46e5, #06b6d4);
      color: white;
      padding: 20px;
      text-align: center;
    }
    main {
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin: 5px 0 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    label {
      font-weight: 600;
    }
    .save-btn {
      background: #4f46e5;
      color: white;
      padding: 12px 25px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
      font-size: 16px;
    }
    .preview {
      text-align: center;
      padding: 15px;
      background: white;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .preview img {
      max-height: 80px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <header>
    <h2>ðŸ§º Admin Panel â€” Azayaka Laundry</h2>
  </header>

  <main>
    <div class="preview">
      <img id="previewLogo" src="" alt="Logo Laundry">
      <h2 id="previewNama">Nama Laundry</h2>
      <p id="previewBio" style="font-style:italic;">Bio Laundry...</p>
    </div>

    <label>Nama Toko</label>
    <input id="nama_toko" placeholder="Masukkan nama laundry">

    <label>Logo (URL)</label>
    <input id="logo" placeholder="Tempel URL logo">

    <label>Bio Laundry</label>
    <textarea id="bio" rows="2" placeholder="Deskripsi singkat laundry..."></textarea>

    <label>Nomor WhatsApp Admin</label>
    <input id="admin_wa" placeholder="Contoh: 628xxxxxxxxxx">

    <label>Nomor WhatsApp Kurir</label>
    <input id="kurir_wa" placeholder="Contoh: 628xxxxxxxxxx">

    <label>Warna Utama</label>
    <input id="warna_utama" type="color" value="#4f46e5">

    <label>Warna Gradasi Kedua</label>
    <input id="warna_gradasi" type="color" value="#06b6d4">

    <label>URL Foto Latar</label>
    <input id="bg_foto" placeholder="https://...">

    <label>Opacity Warna (0â€“1)</label>
    <input id="opacity_overlay" type="number" step="0.1" min="0" max="1" value="0.5">

    <label>Daftar Harga Laundry Satuan</label>
    <textarea id="harga_satuan" rows="3" placeholder='Contoh: [{"nama":"Kemeja","harga":8000}]'></textarea>

    <label>Menu Informasi (misal sosmed atau link lain)</label>
    <textarea id="menu_info" rows="3" placeholder='Contoh: {"Instagram":"https://instagram.com/azayaka"}'></textarea>

    <label>Personal Access Token (PAT GitHub)</label>
    <input id="pat" placeholder="Masukkan PAT GitHub">

    <button class="save-btn" onclick="saveConfig()">ðŸ’¾ Simpan ke GitHub</button>
  </main>

  <script>
    const repoOwner = "Zlinkhub";
    const repoName = "orderhere";
    const configPath = "config.json";

    async function loadConfig() {
      const res = await fetch("config.json");
      const data = await res.json();
      for (const key in data) {
        if (document.getElementById(key)) {
          const el = document.getElementById(key);
          el.value = typeof data[key] === "object" ? JSON.stringify(data[key]) : data[key];
        }
      }
      updatePreview();
    }

    function updatePreview() {
      document.getElementById("previewLogo").src = document.getElementById("logo").value;
      document.getElementById("previewNama").innerText = document.getElementById("nama_toko").value || "Nama Laundry";
      document.getElementById("previewBio").innerText = document.getElementById("bio").value || "Bio Laundry...";
    }

    async function saveConfig() {
      const pat = document.getElementById("pat").value.trim();
      if (!pat) return alert("Masukkan Personal Access Token (PAT) terlebih dahulu!");

      const config = {
        nama_toko: document.getElementById("nama_toko").value,
        logo: document.getElementById("logo").value,
        bio: document.getElementById("bio").value,
        admin_wa: document.getElementById("admin_wa").value,
        kurir_wa: document.getElementById("kurir_wa").value,
        warna_utama: document.getElementById("warna_utama").value,
        warna_gradasi: document.getElementById("warna_gradasi").value,
        bg_foto: document.getElementById("bg_foto").value,
        opacity_overlay: parseFloat(document.getElementById("opacity_overlay").value),
        harga_satuan: JSON.parse(document.getElementById("harga_satuan").value || "[]"),
        menu_info: JSON.parse(document.getElementById("menu_info").value || "{}"),
        pat: ""
      };

      const base64 = btoa(unescape(encodeURIComponent(JSON.stringify(config, null, 2))));
      const url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${configPath}`;

      const getFile = await fetch(url);
      const fileData = await getFile.json();
      const sha = fileData.sha;

      const res = await fetch(url, {
        method: "PUT",
        headers: {
          "Authorization": `token ${pat}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          message: "Update config.json via Admin Panel",
          content: base64,
          sha
        })
      });

      if (res.ok) alert("âœ… Konfigurasi berhasil disimpan ke GitHub!");
      else alert("âŒ Gagal menyimpan! Periksa PAT dan izin repositori.");
    }

    document.querySelectorAll("input, textarea").forEach(el => {
      el.addEventListener("input", updatePreview);
    });

    loadConfig();
  </script>
</body>
</html>